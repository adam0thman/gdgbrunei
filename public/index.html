<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>GDG Brunei | Bid To WIn</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/6.6.2/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/6.6.2/firebase-auth.js"></script>
  <script defer src="/__/firebase/6.6.2/firebase-firestore.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</head>

<body>


  <nav class="container navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand font-weight-bold text-info" href="#">GDG</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Admin</a>
        </li>
      </ul>
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>
    </div>
  </nav>

  <div class="container">
    <div class="mt-5 text-center">
      <h1 class="display-3">Bid now! :)</h1>
      <p class="lead">This is a public bidding site. Fill in your name, and bid amount below.</p>
    </div>

    <div class="mt-5 text-center">
      <h1 class="display-4">Current bid is $<text id="txtCurrentBid" class="text-info"></text> by <text
          id="txtCurrentBidder" class="text-info"></text>.
      </h1>
      <p class="lead">Bid was placed on <text id="txtCurrentBidTime" class="text-info"></text></p>
    </div>

    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4 mt-5 text-center">
        <form>
          <div class="form-group">
            <label for="inputName" class="sr-only">Name</label>
            <input type="text" class="form-control form-control-lg text-center" id="inputName"
              aria-describedby="nameHelp" placeholder="Enter your name & click Bid">
            <small id="nameHelp" class="form-text text-muted">Just enter your name - be it fake or real.</small>
          </div>
        </form>
        <button type="submit" class="btn btn-block btn-outline-primary" id="btnBid">Bid</button>
      </div>
      <div class="col-md-4"></div>
    </div>


  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
      //
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

      try {
        let app = firebase.app();
        let features = ['auth', 'database', 'messaging', 'storage', 'firestore'].filter(feature => typeof app[feature] === 'function');
        //document.getElementById('infoload').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
      } catch (e) {
        console.error("Error: " + e);
        //document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
      }


      const db = firebase.firestore();
      db.collection("currentbid").doc("currentbid")
        .onSnapshot({
          // Listen for document metadata changes
          includeMetadataChanges: true
        }, function (bidDoc) {
          console.log("bidDoc is: " + JSON.stringify(bidDoc.data()));
          $('#txtCurrentBid').text(bidDoc.data().amount);
          $('#txtCurrentBidder').text(bidDoc.data().bidder);
          $('#txtCurrentBidTime').text(bidDoc.data().timestamp.toDate());
        });

      $('#btnBid').on('click', function () {
        var bidderName = $('#inputName').val();
        var docRef = db.collection('currentbid').doc('currentbid');
        docRef.update({
          amount: firebase.firestore.FieldValue.increment(0.01),
          bidder: bidderName,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(()=>{
          console.log('Done updatee!');
        }).catch((e) => {
          console.log('Error updating data: '+e);
        });
      });
    });

  </script>
</body>

</html>